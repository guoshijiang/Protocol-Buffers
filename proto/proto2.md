
# 第二章.proto2指南

本指南介绍如何使用协议缓冲区语言来构建协议缓冲区数据，包括.proto文件语法以及如何从.proto文件生成数据访问类。 它涵盖协议缓冲区语言的proto2版本：有关较新的proto3语法的信息，请参阅Proto3语言指南。

对于使用本文档中描述的许多功能的逐步示例，请参阅所选语言的教程。

## 第一节.定义一个消息类型

首先，让我们来看一个非常简单的例子。让我们来看你想定义一个搜索数据消息格式，每个搜索请求有一个字符串，将获得一个你感兴趣的结果，并且对结果做了分页处理，你使用下面这个.proto文件定义消息类型。

    message SearchRequest {
      required string query = 1;
      optional int32 page_number = 2;
      optional int32 result_per_page = 3;
    }

SearchRequest消息定义了三个字段（名字/值对），数据中的没有一块你都要包含在这个message类型中，每个字段有一个名字和一个类型

### 一.指定字段类型

在上面的例子中，所有字段都是标量类型：两个整形（page_number和result_per_page）和一个字符串类型(query)。当然，你也可以指定一个字段为复合类型，包括枚举和其他的消息类型

### 二.分配标签

如你看到的一样，每个字段在消息定义中都有一个唯一的数字标志。这些标志在消息二进制格式中用来标识你的字段，只要你的消息类型在使用这些标识值都不会改变。请注意，值为1到15的变量需要一个字节进行编码，包括标识号和字段类型（您可以在协议缓冲区编码中找到更多相关信息）。 范围16到2047中的标签需要两个字节。 因此，您应该为非常频繁出现的消息元素预留标签1至15。 请记住为将来可能添加的频繁出现的元素留出一些空间。

最小的标识数字可以指定为1，最大值是2的29次方-1，或者是536,870,911。你不能使用数字19000到19999(FieldDescriptor::kFirstReservedNumber到FieldDescriptor::kLastReservedNumber), 因为它们是为协议缓冲区实现保留的。如果您在.proto中使用这些保留的数字之一，则协议缓冲区编译器会发出错误。 同样，您不能使用任何以前保留的标签。

### 三.指定字段的规则











